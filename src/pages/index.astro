---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getAllPages } from '../lib/wordpress';
import iOSAppAd from '../components/iOSAppAd.astro'; 
import { makeLinksRelative } from '../lib/utils';

// Get the specific homepage by slug
const pages = await getAllPages();
const homepage = pages.find(page => page.slug === '22416-2');

if (!homepage) {
  throw new Error('Homepage not found! Check if page with slug "22416-2" exists.');
}

const seo = homepage.seo || {};
const title = seo.title || homepage.title || 'Dragos Roua';
const description = seo.metaDesc || homepage.content?.replace(/<[^>]*>/g, '').substring(0, 160) || '';
const ogImage = seo.opengraphImage?.sourceUrl || homepage.featuredImage?.node?.sourceUrl;
const schema = seo.schema?.raw || null;

const pageContent = makeLinksRelative(homepage.content);
---

<BaseLayout 
  title={title}
  description={description}
  ogImage={ogImage}
  canonical="https://dragosroua.com/"
  schema={schema}
>
 <!-- Test: Add component here -->
  <iOSAppAd />
  <div class="homepage-content wp-content" set:html={pageContent} />
</BaseLayout>