---
import BaseLayout from '../layouts/BaseLayout.astro';
import EmailSignup from '../components/EmailSignup.astro';
import { getAllPages, getAllPosts } from '../lib/wordpress';
import { updateWordPressImageUrls, cleanSchemaUrls, generateExcerpt } from '../lib/utils';

// Get the specific homepage by slug for SEO data
const pages = await getAllPages();
const homepage = pages.find((page: { slug: string; }) => page.slug === '22416-2');

// Get recent posts for blog preview
const allPosts = await getAllPosts();
const recentPosts = allPosts.slice(0, 3);

if (!homepage) {
  throw new Error('Homepage not found! Check if page with slug "22416-2" exists.');
}

const seo = homepage.seo || {};
// Optimized homepage metadata (Option 2: Content-First)
const title = 'Dragos Roua - 20 Years of Personal Development & Productivity';
const description = 'Entrepreneur, iOS developer & writer sharing insights on personal development, financial resilience, and productivity. Creator of addTaskManager. 1,300+ articles since 2006.';
const ogImage = updateWordPressImageUrls(seo.opengraphImage?.sourceUrl) || 'https://dragosroua.com/images/default-featured-1200-630.png';

// Custom homepage schema (fixes WordPress schema issues)
const customSchema = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebPage",
      "@id": "https://dragosroua.com/",
      "url": "https://dragosroua.com/",
      "name": "Dragos Roua - Personal Development & Productivity",
      "isPartOf": { "@id": "https://dragosroua.com/#website" },
      "about": { "@id": "https://dragosroua.com/#/schema/person/bbca0f916c763e8343efcaee8af6caf2" },
      "description": description,
      "inLanguage": "en-US",
      "potentialAction": [{
        "@type": "ReadAction",
        "target": ["https://dragosroua.com/"]
      }]
    },
    {
      "@type": "WebSite",
      "@id": "https://dragosroua.com/#website",
      "url": "https://dragosroua.com/",
      "name": "Dragos Roua",
      "description": "Personal development, productivity, and financial resilience insights",
      "publisher": { "@id": "https://dragosroua.com/#/schema/person/bbca0f916c763e8343efcaee8af6caf2" },
      "potentialAction": [{
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "https://dragosroua.com/?s={search_term_string}"
        },
        "query-input": {
          "@type": "PropertyValueSpecification",
          "valueRequired": true,
          "valueName": "search_term_string"
        }
      }],
      "inLanguage": "en-US"
    },
    {
      "@type": ["Person", "Organization"],
      "@id": "https://dragosroua.com/#/schema/person/bbca0f916c763e8343efcaee8af6caf2",
      "name": "Dragos Roua",
      "image": {
        "@type": "ImageObject",
        "inLanguage": "en-US",
        "@id": "https://dragosroua.com/#/schema/person/image/",
        "url": "https://dragosroua.com/images/dragos-hat.png",
        "contentUrl": "https://dragosroua.com/images/dragos-hat.png",
        "width": 94,
        "height": 65,
        "caption": "Dragos Roua"
      },
      "logo": { "@id": "https://dragosroua.com/#/schema/person/image/" },
      "description": "Entrepreneur, iOS developer & writer. Creator of addTaskManager.",
      "sameAs": [
        "https://twitter.com/dragosroua",
        "https://github.com/dragosroua",
        "https://linkedin.com/in/dragosroua"
      ]
    }
  ]
};

const schema = customSchema;
---

<BaseLayout
  title={title}
  description={description}
  ogImage={ogImage}
  canonical="https://dragosroua.com/"
  schema={schema}
>
  <!-- Site Header -->
  <header class="site-header">
    <h1>Hi, I'm Dragos</h1>
    <p class="site-tagline">Entrepreneur, writer, app creator sharing insights on personal development, productivity, and financial resilience since 2006.</p> 
    <p class="site-tagline">Scroll down for the full story.</p>
  </header>

  <!-- addTaskManager Featured Box -->
  <div class="atm-hero">
    <h2 class="atm-hero-title">currently working on: addTaskManager</h2>

    <div class="atm-hero-grid">
  <!-- Left Column: Text -->
  <div class="atm-text-col">
    <p class="atm-desc">Take control of your life with powerful Assess-Decide-Do framework</p>
    <p class="atm-desc">iPhone, iPad and iMac real time data syncing</p>
    <p class="atm-desc">Available in English, ÌïúÍµ≠Ïñ¥, Êó•Êú¨Ë™û, ‰∏≠Êñá, Fran√ßais and Ti·∫øng Vi·ªát</p>
  </div>
  
  <!-- Right Column: Landscape Image -->
  <div class="atm-image-col">
    <img 
      src="/images/addTaskManager-hero.webp" 
      alt="addTaskManager App Screenshot"
      class="atm-hero-image"
    />
  </div>
</div>
    
    <!-- Row 2: Buttons (centered, side by side) -->
    <div class="atm-buttons">
      <a 
        href="https://itunes.apple.com/app/apple-store/id1492487688?mt=8" 
        class="atm-button" 
        target="_blank" 
        rel="noopener noreferrer"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
        </svg>
        Download on App Store
      </a>
      
      <a 
		href="/productivity-apps/" 
		class="atm-button"
		aria-label="Learn more about addTaskManager iOS productivity app"
		>
		Learn More
		</a>
    </div>
  </div>

  <!-- Blog Preview Section -->
  <section class="blog-preview">
    <h2>Latest articles</h2>
    <div class="blog-grid">
      {recentPosts.map((post) => (
        <article class="blog-card">
          {post.featuredImage?.node?.sourceUrl && (
            <a href={post.uri} class="blog-card-image-link">
              <img
                src={updateWordPressImageUrls(post.featuredImage.node.sourceUrl)}
                alt={post.featuredImage.node.altText || post.title}
                class="blog-card-image"
                loading="lazy"
              />
            </a>
          )}
          <div class="blog-card-content">
            <h3 class="blog-card-title">
              <a href={post.uri} set:html={post.title} />
            </h3>
            <p class="blog-card-excerpt">
              {post.seo?.metaDesc ? generateExcerpt(post.seo.metaDesc, 20) : generateExcerpt(post.content, 20)}
            </p>
            <a href={post.uri} class="blog-card-link">Read more ‚Üí</a>
          </div>
        </article>
      ))}
    </div>
    <div class="blog-cta">
      <a href="/blog/" class="blog-cta-button">View All Articles</a>
    </div>
  </section>

  <!-- About the Author Section -->
  <section class="about-section">
    <div class="about-container">
      <!-- Avatar Image (left aligned) -->
      <div class="about-avatar">
        <img 
          src="/images/dragos-about.webp" 
          alt="Dragos Roua"
          class="avatar-image"
        />
      </div>
      
      <!-- Content (right side) -->
      <div class="about-content">
        <h2>Hi, I'm Dragos</h2>
        
        <p>I'm an entrepreneur, iOS developer, digital nomad and writer splitting my time between Europe (Portugal) and Asia (currently Vietnam). I code since 1987 (started on Z80 processors) and got into AI in 2019, before ChatGPT made it cool.</p>
        
        <p>After years of trying every task management system, I built addTaskManager to solve my own chaos.</p>
        
        <p>Previously founded multiple startups, wrote extensively about 
		<a href="/category/personal-development/">personal development</a>, 
		<a href="/category/financial-resilience/">financial resilience</a> and 
		<a href="/category/meaningful-relationships/">meaningful relationships</a>, 
		and discovered that the best systems are the ones that adapt to how we actually think, not how we should think.</p>
        
        <p>When I'm not coding, you'll find me writing about the intersection of technology and mindfulness, or exploring the coffee shops of Saigon.</p>
        
        <!-- Social Links -->
        <div class="social-links">
          <a href="https://twitter.com/dragosroua" aria-label="Twitter" target="_blank" rel="noopener noreferrer">
            <span>ùïè</span>
          </a>
          <a href="https://github.com/dragosroua" aria-label="GitHub" target="_blank" rel="noopener noreferrer">
            <span>G</span>
          </a>
          <a href="https://linkedin.com/in/dragosroua" aria-label="LinkedIn" target="_blank" rel="noopener noreferrer">
            <span>in</span>
          </a>
          <a href="https://medium.com/@dragosroua" aria-label="Medium" target="_blank" rel="noopener noreferrer">
            <span>M</span>
          </a>
        </div>
      </div>
    </div>
  </section>

	<EmailSignup />

</BaseLayout>

<style>
  /* Site Header */
  .site-header {
    text-align: center;
    margin: 0 0 40px 0;
    padding: 30px 20px;
  }

  .site-header h1 {
    font-size: 2.5rem;
    font-weight: 800;
    color: #2d3748;
    margin: 0 0 12px 0;
    line-height: 1.2;
  }

  .site-tagline {
    font-size: 1.2rem;
    color: #595959;
    margin: 0;
    font-weight: 400;
  }

  /* addTaskManager Hero Section */
  .atm-hero {
    background: linear-gradient(135deg, #4338ca 0%, #6b21a8 100%);
    border-radius: 12px;
    padding: 40px 30px;
    margin: 0 0 40px 0;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
  }
  
  .atm-hero-title {
    color: #ffffff;
    font-size: 2.5rem;
    font-weight: 700;
    margin: 0 0 30px 0;
    text-align: center;
  }
  
  /* Grid: 2 EQUAL columns */
  .atm-hero-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
    align-items: center;
  }
  
  /* Left Column: Text */
  .atm-text-col {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
  
  .atm-subtitle {
    color: #ffffff;
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0 0 16px 0;
    line-height: 1.3;
  }

  .atm-desc {
    color: rgba(255, 255, 255, 0.95);
    font-size: 1rem;
    margin: 0 0 12px 0;
    line-height: 1.6;
  }
  
  .atm-desc:last-child {
    margin-bottom: 0;
  }
  
  /* Right Column: Landscape Image */
  .atm-image-col {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .atm-hero-image {
    width: 100%;
    max-width: 350px;
    height: auto;
    border-radius: 20px;
    border: 3px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  }
  
  .atm-buttons {
    display: flex;
    justify-content: center;
    gap: 16px;
    flex-wrap: wrap;
  }
  
  .atm-button {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    background: #000000;
    color: #ffffff;
    padding: 14px 28px;
    border-radius: 10px;
    text-decoration: none;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
  }
  
  .atm-button:hover {
    background: #1a1a1a;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
    color: #ffffff;
  }
  
  .atm-button svg {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
  }

  /* Blog Preview Section */
  .blog-preview {
    margin: 60px 0;
  }

  .blog-preview h2 {
    font-size: 2.5rem;
    font-weight: 800;
    color: #2d3748;
    text-align: center;
    margin: 0 0 40px 0;
  }

  .blog-grid {
    display: grid;
    gap: 2rem;
    margin-bottom: 40px;
  }

  .blog-card {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 1.5rem;
    padding: 1.5rem;
    background: #f9f9f9;
    border-radius: 12px;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .blog-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .blog-card-image-link {
    display: block;
  }

  .blog-card-image {
    width: 100%;
    height: 220px;
    object-fit: cover;
    border-radius: 8px;
  }

  .blog-card-content {
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
  }

  .blog-card-title {
    margin: 0 0 0.5rem 0;
    font-size: 1.5rem;
    line-height: 1.3;
  }

  .blog-card-title a {
    color: #2d3748;
    text-decoration: none;
    transition: color 0.2s;
  }

  .blog-card-title a:hover {
    color: #4338ca;
  }

  .blog-card-excerpt {
    color: #595959;
    font-size: 1rem;
    line-height: 1.6;
    margin: 0 0 1rem 0;
  }

  .blog-card-link {
    color: #4338ca;
    text-decoration: none;
    font-weight: 600;
    font-size: 0.95rem;
    transition: color 0.2s;
  }

  .blog-card-link:hover {
    color: #3730a3;
    text-decoration: underline;
  }

  .blog-cta {
    text-align: center;
  }

  .blog-cta-button {
    display: inline-block;
    background: #4338ca;
    color: white;
    padding: 14px 32px;
    border-radius: 10px;
    text-decoration: none;
    font-size: 1.1rem;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(67, 56, 202, 0.3);
  }

  .blog-cta-button:hover {
    background: #3730a3;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(67, 56, 202, 0.4);
    color: white;
  }

  /* About Section */
  .about-section {
    background: #f0f4f8;
    border-radius: 25px;
    padding: 40px 30px;
    margin: 40px 0;
  }
  
  .about-container {
    display: grid;
    grid-template-columns: 150px 1fr;
    gap: 30px;
    align-items: start;
  }
  
  .about-avatar {
    display: flex;
    justify-content: center;
  }
  
  .avatar-image {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid white;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  }
  
  .about-content h2 {
    font-size: 2.5rem;
    margin: 0 0 1.5rem 0;
    color: #2d3748;
  }
  
  .about-content p {
    font-size: 1.1rem;
    color: #4a5568;
    line-height: 1.8;
    margin-bottom: 1rem;
  }
  
  .about-content p:last-of-type {
    margin-bottom: 2rem;
  }
  
  .social-links {
    display: flex;
    gap: 1rem;
  }
  
  .social-links a {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    color: #4a5568;
    font-weight: 700;
    font-size: 1.2rem;
    transition: all 0.3s;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
  
  .social-links a:hover {
    background: #4338ca;
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
  }
  
  /* Mobile responsive */
  @media (max-width: 768px) {
    .site-header {
      margin: 0 0 30px 0;
      padding: 20px 15px;
    }

    .site-header h1 {
      font-size: 1.8rem;
    }

    .site-tagline {
      font-size: 1rem;
    }

    .blog-preview {
      margin: 40px 0;
    }

    .blog-preview h2 {
      font-size: 2rem;
      margin: 0 0 30px 0;
    }

    .blog-grid {
      gap: 1.5rem;
      margin-bottom: 30px;
    }

    .blog-card {
      grid-template-columns: 1fr;
      gap: 1rem;
      padding: 1rem;
    }

    .blog-card-image {
      height: 200px;
    }

    .blog-card-title {
      font-size: 1.3rem;
    }

    .blog-card-excerpt {
      font-size: 0.95rem;
    }

    .blog-cta-button {
      font-size: 1rem;
      padding: 12px 28px;
    }

    .atm-hero {
      padding: 30px 20px;
    }

    .atm-hero-title {
      font-size: 1.8rem;
    }
    
    .atm-hero-grid {
      grid-template-columns: 1fr;
      gap: 24px;
      text-align: center;
    }

    .atm-desc {
      font-size: 0.95rem;
    }
    
    .atm-hero-image {
      max-width: 280px;
    }
    
    .atm-button {
      font-size: 15px;
      padding: 12px 24px;
    }
    
    /* About Section Mobile */
    .about-section {
      padding: 30px 20px;
    }
    
    .about-container {
      grid-template-columns: 1fr;
      gap: 20px;
      text-align: center;
    }
    
    .avatar-image {
      width: 120px;
      height: 120px;
    }
    
    .about-content h2 {
      font-size: 2rem;
    }
    
    .about-content p {
      font-size: 1rem;
    }
    
    .social-links {
      justify-content: center;
    }
  }
  
  @media (max-width: 480px) {
    .atm-buttons {
      flex-direction: column;
      align-items: stretch;
    }
    
    .atm-button {
      justify-content: center;
    }
  }
</style>
