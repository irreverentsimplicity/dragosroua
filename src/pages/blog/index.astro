---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getAllPosts } from '../../lib/wordpress';

const posts = await getAllPosts();

// Sort by date, newest first
const sortedPosts = posts.sort((a, b) => 
  new Date(b.date).getTime() - new Date(a.date).getTime()
);

// Show first 50 posts (paginate later if needed)
const displayPosts = sortedPosts.slice(0, 50);
---

<BaseLayout 
  title="Blog - Dragos Roua"
  description="All blog posts"
>
  <h1>Blog Posts</h1>
  
  <div class="posts-list">
    {displayPosts.map(post => (
      <article class="post-preview">
        {post.featuredImage?.node?.sourceUrl && (
          <a href={post.uri}>
            <img 
              src={post.featuredImage.node.sourceUrl} 
              alt={post.featuredImage.node.altText || post.title}
              class="preview-image"
            />
          </a>
        )}
        <div class="post-info">
          <h2>
            <a href={post.uri} set:html={post.title} />
          </h2>
          <time datetime={post.date}>
            {new Date(post.date).toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            })}
          </time>
        </div>
      </article>
    ))}
  </div>
</BaseLayout>

<style>
  .posts-list {
    display: grid;
    gap: 2rem;
    margin-top: 2rem;
  }
  
  .post-preview {
    display: grid;
    grid-template-columns: 200px 1fr;
    gap: 1.5rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid #eee;
  }
  
  .preview-image {
    width: 200px;
    height: 150px;
    object-fit: cover;
    border-radius: 8px;
  }
  
  .post-info h2 {
    margin: 0 0 0.5rem;
    font-size: 1.5rem;
  }
  
  .post-info a {
    color: #333;
    text-decoration: none;
  }
  
  .post-info a:hover {
    color: #667eea;
  }
  
  .post-info time {
    color: #666;
    font-size: 0.9rem;
  }
  
  @media (max-width: 640px) {
    .post-preview {
      grid-template-columns: 1fr;
    }
    
    .preview-image {
      width: 100%;
      height: 200px;
    }
  }
</style>